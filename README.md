# Colorado 14ers MCP Server

An MCP server for querying Colorado 14ers data with OpenAI Apps SDK widgets built with React, TypeScript, and Vite.

## Prerequisites

- Node.js 18+
- Python 3.10+
- pnpm (recommended) or npm/yarn

## Setup

### Install Node.js dependencies

```bash
pnpm install
```

### Install Python dependencies

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### Configure Environment Variables

Create a `.env` file in the root directory with your database credentials:

```bash
dbname=postgres
user=your_database_user
password=your_database_password
host=your_database_host
port=5432
```

**Note:** Never commit your `.env` file to version control. It's already included in `.gitignore`.

### Build the widgets

The widgets are built using Vite and React. Build them before running the server:

```bash
pnpm run build
```

This will generate HTML, JS, and CSS files in the `assets/` directory.

### Serve static assets (for local development)

For local development, you need to serve the static assets separately:

```bash
pnpm run serve
```

This starts a static file server on `http://localhost:4444` with CORS enabled.

## Running the Server

### Development

1. Build the widgets: `pnpm run build`
2. Start the static file server: `pnpm run serve` (in one terminal)
3. Start the MCP server: `uvicorn server:app --port 8000` (in another terminal)

### Production

#### Option 1: Deploy to Supabase Storage (Recommended)

The widgets are configured to be served from Supabase Storage. To deploy:

1. **Build with Supabase URL:**
   ```bash
   pnpm run build:supabase
   ```

2. **Upload assets to Supabase Storage:**
   
   First, get your Supabase access token:
   - Go to your Supabase project dashboard
   - Navigate to Settings > API
   - Copy your **service_role** key (⚠️ keep this secret! Never commit to git)
   - **Important**: You need the `service_role` key (not `anon` key) for uploads because it bypasses Row Level Security
   
   Then upload the files. You can either:
   
   **Option A: Add to .env file (Recommended)**
   ```bash
   # Add to .env file:
   SUPABASE_ACCESS_TOKEN=your_service_role_key
   
   # Then run:
   pnpm run deploy:supabase
   ```
   
   **Option B: Set for one command**
   ```bash
   SUPABASE_ACCESS_TOKEN=your_service_role_key pnpm run deploy:supabase
   ```
   
   **Option C: Export in your shell**
   ```bash
   export SUPABASE_ACCESS_TOKEN=your_service_role_key
   pnpm run deploy:supabase
   ```

3. **Ensure your Supabase Storage bucket is public:**
   - Go to Storage in your Supabase dashboard
   - Create a bucket named `widgets` (if it doesn't exist)
   - Set it to **Public** so the files can be accessed

The widgets will be available at:
- `https://kxvaohpqmhdtptwnaoyb.supabase.co/storage/v1/object/public/widgets/mountains-{hash}.js`
- `https://kxvaohpqmhdtptwnaoyb.supabase.co/storage/v1/object/public/widgets/mountains-{hash}.css`
- Similar URLs for `mountain-info` widget

#### Option 2: Deploy to Your Own Server

Set the `BASE_URL` environment variable to your deployed server URL:

```bash
export BASE_URL=https://your-server.com
pnpm run build
```

Then the built HTML files will reference the JS/CSS from your deployed URL.

## Development

### Widget Development

To develop widgets with hot reload:

```bash
pnpm run dev
```

This starts the Vite dev server. Note that you'll still need to build the widgets for the MCP server to use them.

### Project Structure

- `src/` - React/TypeScript widget source files
  - `mountains/` - Mountains map widget
  - `mountain-info/` - Mountain information widget
- `assets/` - Built widget files (generated by build)
- `server.py` - MCP server implementation
- `build-all.mts` - Build script for widgets

## Widgets

### Mountains Map Widget

Displays a map of Colorado 14ers with interactive markers and a results panel.

### Mountain Info Widget

Shows detailed information about a specific mountain including elevation, rank, routes, and weather.

## Testing in ChatGPT

1. Enable developer mode in ChatGPT
2. Add your MCP server in Settings > Connectors
3. For local testing, use ngrok to expose your server:

```bash
ngrok http 8000
```

Then use the ngrok URL in ChatGPT: `https://<your-ngrok-url>.ngrok-free.app/mcp`

